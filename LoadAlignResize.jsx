var loadLayersFromScript = true; // must be before Photomerge include//@includepath "/Applications/Adobe Photoshop CS4/Presets/Scripts/"//@include "Load Files into Stack.jsx"//@show include/*var psdOpts = new PhotoshopSaveOptions();psdOpts.embedColorProfile = true;psdOpts.alphaChannels = true;psdOpts.layers = true;*/var jpegOptions = new JPEGSaveOptions();jpegOptions.quality=12;jpegOptions.scans=5;/*var workFolder = Folder.selectDialog();
alert(workFolder);*/while (app.documents.length) {		app.activeDocument.close();}//workFolder="/Users/jafrey/Pictures/India/Panoramas/Udaipur 9";var workFolder = Folder.selectDialog();workFolder=Folder(workFolder);
var folders = workFolder.getFiles( function( file ) { return file instanceof Folder; } );	for(var i = 0; i < folders.length; i++ ) {		try {			parseFolder(folders[i]);		} catch(err) {		}	}function parseFolder(folder) {	var folders = folder.getFiles( function( file ) { return file instanceof Folder; } );	var jpg= folder.getFiles("*.jpg");	var dng= folder.getFiles("*.dng");	var files=jpg.concat(dng);	loadLayers.intoStack(files,true);	if (files.length>0) {			var folder=files[0].parent;			exportChildren(activeDocument,folder);	}	activeDocument.close(SaveOptions.DONOTSAVECHANGES);}function exportChildren(orgObj,folder) {	for( var i = 0; i < orgObj.layers.length; i++) {		orgObj.layers[i].visible = true;		var layerName = orgObj.layers[i].name;  // store layer name before change doc		var duppedDocumentTmp = orgObj.duplicate();		duppedDocumentTmp.flatten();			var saveFile = new File(folder + "/aligned_" + layerName);		duppedDocumentTmp.saveAs(saveFile, jpegOptions, true, Extension.LOWERCASE);		duppedDocumentTmp.close(SaveOptions.DONOTSAVECHANGES);		orgObj.layers[i].visible = false;	}}